name: PHP Code Check

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  php-code-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.0'
        tools: composer, phpcs
        
    - name: Install WordPress Coding Standards
      run: |
        composer global require wp-coding-standards/wpcs
        phpcs --config-set installed_paths $HOME/.composer/vendor/wp-coding-standards/wpcs
    
    - name: Check PHP Syntax
      run: |
        find . -type f -name '*.php' -print0 | xargs -0 -n1 php -l
        
    - name: Run PHPCS
      run: phpcs --standard=WordPress --extensions=php .

    - name: Check JavaScript files
      uses: actions/setup-node@v3
      with:
        node-version: '16'
    
    - name: Install ESLint
      run: |
        npm install eslint eslint-plugin-jquery
        
    - name: Run ESLint
      run: npx eslint . --ext .js